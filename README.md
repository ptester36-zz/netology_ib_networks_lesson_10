# БЕЗ ЛИМИТА

* Скриншот с запросами ab до включения limit_req на nginx
![](pic/um.png)

* Скриншот с запросами ab после включения limit_req на nginx
![](pic/dois.png)

* Скриншот с запросами ab после включения fail2ban (не обязательно)
![](pic/tres.png)

# Suricata

1. 10_000 запросов по 100

    Суриката видит трафик вот так:
    
    * FIN с неправильной последовательностью
    * Пакет с недопустимым подтверждением
    * FIN с неправильной последовательностью
    * Установлено недопустимое подтверждение 

2. 10_000 запросов по 1000

    Когда одновременно идет больший поток трафика, то взгляд суриката изменяется вот так:

    * Установлено недопустимое подтверждение
    * Пакет с недопустимым подтверждением
    * FIN с неправильной последовательностью

    И так далее

3. 10_000 запросов по 10

    Когда одновременно идет меньший поток трифка, суриката реагирует так:
    
    * Пакет с недопустимым подтверждением
    * Установлено недопустимое подтверждение
    * Пакет с недопустимым подтверждением
    * FIN с неправильной последовательностью


Итого:

При любом из трафиков за один раз 10/100/1000 суриката блокирует примерно одинаковое количество. Из 10000 примерно 9500 тысяч. Но при разном количестве трафика за один раз, суриката по разному видит вредоносный трафик, где то сначала видит пакеты FIN, где то начинает видеть пакет с недопустимым подтверждением, где устанавливает недопустимое подтверждение.


# Suricata Rules

Я думаю, что срабатывание происходит при атаке оконечного устройства, когда на конечное устройство идет большой трафик. В данном случае оконечное устройство - это сервер NGINX. Правило направлено на то, что если срабатывает условие, то начинается запись лога, тем самым происходит Alert.